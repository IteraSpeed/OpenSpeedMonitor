<h1>
  {{ 'frontend.de.iteratec.osm.jobResult.title' | translate }}
</h1>
<p class="description">
  {{ 'frontend.de.iteratec.osm.jobResult.description' | translate }}
</p>

<div class="card">
  <div class="col-sm-3 job-selection ">
    <label for="select-job">
      <strong>{{ 'frontend.de.iteratec.osm.jobResult.select.label.job' | translate }}</strong>
    </label>
    <ng-select [(ngModel)]="selectedJob" (change)="setJob(selectedJob)" [items]="jobs"
               clearAllText="{{ 'frontend.de.iteratec.osm.jobResult.select.clearAll' | translate }}"
               id="select-job"
               loadingText="{{ 'frontend.de.iteratec.osm.jobResult.select.loading' | translate }}"
               notFoundText="{{ 'frontend.de.iteratec.osm.jobResult.select.notFound' | translate }}"
               placeholder="{{ 'frontend.de.iteratec.osm.jobResult.select.placeholder' | translate }}"
               typeToSearchText="{{ 'frontend.de.iteratec.osm.jobResult.select.search' | translate }}">
    </ng-select>
  </div>

  <div *ngIf="selectedJob && jobResults.length === 0"
       class="col-sm-12">{{ 'frontend.de.iteratec.osm.jobResult.noData' | translate }}</div>

  <table *ngIf="jobResults.length > 0" class="table table-striped">
    <thead>
    <tr>
      <th class="date-table-head">
        <span (click)="sort('date')" class="sortable">
          {{ 'frontend.de.iteratec.osm.jobResult.tableHead.date' | translate }}
          <i *ngIf="currentSortingRule.column === 'date' && currentSortingRule.direction === 'desc'"
             aria-hidden="true" class="fas fa-sort-down"></i>
          <i *ngIf="currentSortingRule.column === 'date' && currentSortingRule.direction === 'asc'"
             aria-hidden="true" class="fas fa-sort-up"></i>
        </span>
        <span><i class="far fa-calendar date-filter-icon"></i></span>
        <br>
        <span (click)="sort('date')" class="job-id sortable">
          {{ 'frontend.de.iteratec.osm.jobResult.tableHead.testId' | translate }}
        </span>
      </th>
      <th>
        <span (click)="sort('testAgent')" class="sortable">
          {{ 'frontend.de.iteratec.osm.jobResult.tableHead.testAgent' | translate }}
          <i *ngIf="currentSortingRule.column === 'testAgent' && currentSortingRule.direction === 'desc'"
             aria-hidden="true" class="fas fa-sort-down"></i>
          <i *ngIf="currentSortingRule.column === 'testAgent' && currentSortingRule.direction === 'asc'"
             aria-hidden="true" class="fas fa-sort-up"></i>
        </span>
        <input [(ngModel)]="filter.testAgent" (ngModelChange)="setFilter()"
               [placeholder]="('frontend.de.iteratec.osm.jobResult.filter.placeholder' | translate)"
               class="form-control input-filter"
               type="text">

      </th>
      <th class="status-table-head">
        <span (click)="sort('jobResultStatus')" class="sortable">
          {{ 'frontend.de.iteratec.osm.jobResult.tableHead.jobResultStatus' | translate }}
          <i *ngIf="currentSortingRule.column === 'jobResultStatus' && currentSortingRule.direction === 'desc'"
             aria-hidden="true" class="fas fa-sort-down"></i>
          <i *ngIf="currentSortingRule.column === 'jobResultStatus' && currentSortingRule.direction === 'asc'"
             aria-hidden="true" class="fas fa-sort-up"></i>
        </span>
        <ng-select [(ngModel)]="filter.jobResultStatus" (change)="setFilter()" [closeOnSelect]="false"
                   [groupBy]="jobResultStatusGroupByFn" [groupValue]="groupValueFn"
                   [items]="allJobResultStatus" [multiple]="true" [selectableGroup]="true" class="custom"
                   clearAllText="{{ 'frontend.de.iteratec.osm.jobResult.select.clearAll' | translate }}"
                   notFoundText="{{ 'frontend.de.iteratec.osm.jobResult.filter.notFound' | translate }}"
                   placeholder="{{ 'frontend.de.iteratec.osm.jobResult.filter.placeholder' | translate }}"
                   typeToSearchText="{{ 'frontend.de.iteratec.osm.jobResult.select.search' | translate }}">
        </ng-select>
      </th>
      <th class="status-table-head">
        <span (click)="sort('wptStatus')" class="sortable">
          {{ 'frontend.de.iteratec.osm.jobResult.tableHead.wptStatus' | translate }}
          <i *ngIf="currentSortingRule.column === 'wptStatus' && currentSortingRule.direction === 'desc'"
             aria-hidden="true" class="fas fa-sort-down"></i>
          <i *ngIf="currentSortingRule.column === 'wptStatus' && currentSortingRule.direction === 'asc'"
             aria-hidden="true" class="fas fa-sort-up"></i>
        </span>
        <ng-select [(ngModel)]="filter.wptStatus" (change)="setFilter()" [closeOnSelect]="false"
                   [groupBy]="wptStatusGroupByFn" [groupValue]="groupValueFn"
                   [items]="allWptStatus" [multiple]="true" [selectableGroup]="true" class="custom"
                   clearAllText="{{ 'frontend.de.iteratec.osm.jobResult.select.clearAll' | translate }}"
                   notFoundText="{{ 'frontend.de.iteratec.osm.jobResult.filter.notFound' | translate }}"
                   placeholder="{{ 'frontend.de.iteratec.osm.jobResult.filter.placeholder' | translate }}"
                   typeToSearchText="{{ 'frontend.de.iteratec.osm.jobResult.select.search' | translate }}">
        </ng-select>
      </th>
      <th>
        <span (click)="sort('description')" class="sortable">
          {{ 'frontend.de.iteratec.osm.jobResult.tableHead.description' | translate }}
          <i *ngIf="currentSortingRule.column === 'description' && currentSortingRule.direction === 'desc'"
             aria-hidden="true" class="fas fa-sort-down"></i>
          <i *ngIf="currentSortingRule.column === 'description' && currentSortingRule.direction === 'asc'"
             aria-hidden="true" class="fas fa-sort-up"></i>
        </span>
        <input [(ngModel)]="filter.description" (ngModelChange)="setFilter()"
               [placeholder]="('frontend.de.iteratec.osm.jobResult.filter.placeholder' | translate)"
               class="form-control input-filter"
               type="text">
      </th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let test of filteredJobResults">
      <td>
        <a [class.text-info]="isTestNotTerminated(test.jobResultStatus)"
           [class.text-success]="isTestSuccessful(test.jobResultStatus)"
           [class.job-status-error]="hasTestFailed(test.jobResultStatus)"
           href="{{ test.testUrl }}">
          <div
            class="job-date">{{ test.date | date:('frontend.de.iteratec.osm.jobResult.dateFormat' | translate) }}</div>
          <div class="job-id">{{ test.testId }}</div>
        </a>

      </td>
      <td>{{ test.testAgent ? test.testAgent : '-' }}</td>
      <td>{{ test.jobResultStatus ? test.jobResultStatus : '-' }}</td>
      <td>{{ test.wptStatus ? test.wptStatus : '-' }}</td>
      <td>{{ test.description ? test.description : '-' }}</td>
    </tr>
    <tr *ngIf="filteredJobResults.length === 0">
      <td class="no-data-after-filter">-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
      <td>-</td>
    </tr>
    </tbody>
  </table>
</div>
